{% extends "base.html" %}
{% load staticfiles %}

{% block title %}Turn-In: {{ course.name }}: {{ assignment.name }}: {{ student.username }}{% endblock %}

{% block head %}
  <script src="{% static 'js/incomplete.js' %}"></script>
{% endblock %}

{% block main %}
<h2>{{ assignment.name }}: {{ student.full_name }} ({{ student.username }})</h2>

<table id="assignment-info">
  <tr>
    <th>On time?</th>
    <td>
      {% if not latest_submission %}
      <span class="italic">Not yet submitted</span>
      {% elif latest_submission.is_on_time %}
      Yes
      {% else %}
      No
      {% endif %}
    </td>
  </tr>
  <tr>
    <th>Grade:</th>
    {% if latest_submission %}
      <td id="grade" class="{% if not latest_submission.complete %}incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' latest_submission.id %}" data-endpoint-key="formatted_grade">
        {% if not latest_submission.has_been_graded %}
        <span class="result-not-graded italic">Not graded</span>
        {% else %}
        {{ latest_submission.formatted_grade }}
        {% endif %}
      </td>
    {% else %}
      <td>
        <span class="italic">Not yet submitted</span>
      </td>
		{% endif %}
  </tr>
</table>

{% if submissions %}
  <h3 style="border-top:1px solid lightgray;padding-top:15px;">Grader output</h3>
  <div id="grader-output" class="code-result{% if not latest_submission.complete %} incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' latest_submission.id %}" data-endpoint-key="grader_output">
    <div class="result">
      <code><pre>{{ latest_submission.grader_output }}</pre></code>
    </div>
    {% if not latest_submission.complete %}
      <div class="continuous-progress"></div>
    {% endif %}
  </div>

  {% if not request.user.is_student %}
    <h3 style="border-top:1px solid lightgray;padding-top:15px;">Grader errors</h3>
    <div id="grader-errors" class="code-result{% if not latest_submission.complete %} incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' latest_submission.id %}" data-endpoint-key="grader_errors">
      {% if not latest_submission.complete and not latest_submission.grader_errors %}
        <span class="italic">Error output is unavailable until the current run finishes</span>
        <span class="result-incomplete"></span>
      {% endif %}
      <code><pre>{{ latest_submission.grader_errors }}</pre></code>
    </div>
  {% endif %}

  <h3 style="border-top:1px solid lightgray;padding-top:15px;">Latest submission</h3>
  <code><pre>{{ latest_submission_text }}</code></pre>
{% endif %}

<h3 style="border-top:1px solid lightgray;padding-top:15px;">Submissions</h3>
<table id="submission-list" class="has-border">
  <tr>
    <th style="min-width:125px;">Date submitted</th>
    <th style="min-width:65px;">On time?</th>
    <th style="min-width:80px;">Completed?</th>
    <th style="min-width:75px;">Grade</th>
  </tr>
  {% for submission in submissions %}
  <tr>
    {% if submission %}
    <td><a href="{% url 'submissions:show' submission.id %}">{{ submission.date_submitted }}</a></td>
    <td>{% if submission.is_on_time %}Yes{% else %}No{% endif %}</td>
    <td class="{% if submission == latest_submission and not submission.complete %}incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' submission.id %}" data-endpoint-key="complete">
      {% if submission.complete %}Yes{% else %}No{% endif %}
    </td>
    <td id="grade" class="{% if latest_submission == submission and not submission.complete %}incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' submission.id %}" data-endpoint-key="formatted_grade">
      {% if submission.has_been_graded %}
      {{ submission.formatted_grade }}
      {% else %}
      <span class="result-not-graded italic">Not graded</span>
      {% endif %}
    </td>
    {% endif %}
  </tr>
  {% endfor %}

  {% if not submissions %}
  <tr>
    <td colspan="4" class="italic center">No submissions</td>
  </tr>
  {% endif %}
</table>

{% endblock %}

