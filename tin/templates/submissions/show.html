{% extends "base.html" %}
{% load staticfiles %}


{% block title %}
Turn-In: {{ assignment.name }}:
{% if request.user.is_teacher %}{{ student.full_name }}:{% endif %}
Submission #{{ submission_number }}
{% endblock %}

{% block head %}
  <script src="{% static 'js/incomplete.js' %}"></script>
{% endblock %}

{% block main %}
{% if request.user.is_student %}
<h2>{{ assignment.name }}</h2>
<p>{{ assignment.description }}</h1>

<table id="submission-info">
  <tr>
    <th>Due:</th>
    <td>{{ assignment.due }}</td>
  </tr>
  <tr>
    <th>Submitted:</th>
    <td>{{ submission.date_submitted }}</td>
  </tr>
  <tr>
    <th>On time?</th>
    <td>
      {% if submission.is_on_time %}Yes{% else %}No{% endif %}
    </td>
  </tr>
  <tr>
    <th>Completed?</th>
    <td class="{% if not submission.complete %}incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' submission.id %}" data-endpoint-key="complete">
      {% if submission.complete %}Yes{% else %}No{% endif %}
    </td>
  </tr>
  {% if request.user.is_student %}
  <tr>
    <th>Grade:</th>
    <td id="grade" class="{% if not submission.complete %}incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' submission.id %}" data-endpoint-key="formatted_grade">
      {% if not submission.has_been_graded %}
      <span class="result-not-graded italic">Not graded</span>
      {% else %}
      {{ submission.formatted_grade }}
      {% endif %}
    </td>
  </tr>
  {% endif %}
</table>
{% else %}
<h2>{{ assignment.name }} &mdash; {{ submission.student.full_name }}</h2>
<p>{{ assignment.description }}</h1>

<table id="submission-info">
  <tr>
    <th>Due:</th>
    <td>{{ assignment.due }}</td>
  </tr>
  <tr>
    <th>Submitted:</th>
    <td>{{ submission.date_submitted }}</td>
  </tr>
  <tr>
    <th>On time?</th>
    <td>
      {% if submission.is_on_time %}Yes{% else %}No{% endif %}
    </td>
  </tr>
  <tr>
    <th>Completed?</th>
    <td class="{% if not submission.complete %}incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' submission.id %}" data-endpoint-key="complete">
      {% if submission.complete %}Yes{% else %}No{% endif %}
    </td>
  </tr>
  <tr>
    <th>Grade:</th>
    <td id="grade" class="{% if not submission.complete %}incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' submission.id %}" data-endpoint-key="formatted_grade">
      {% if not submission.has_been_graded %}
      <span class="result-not-graded italic">Not graded</span>
      {% else %}
      {{ submission.formatted_grade }}
      {% endif %}
    </td>
  </tr>
</table>
{% endif%}

<h3 style="border-top:1px solid lightgray;padding-top:15px;">Grader output</h3>
<div id="grader-output" class="code-result{% if not submission.complete %} incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' submission.id %}" data-endpoint-key="grader_output">
  <code><pre>{{ submission.grader_output }}</pre></code>
</div>

{% if not request.user.is_student %}
  <h3 style="border-top:1px solid lightgray;padding-top:15px;">Grader errors</h3>
  <div id="grader-errors" class="code-result{% if not submission.complete %} incomplete{% endif %}" data-endpoint="{% url 'submissions:show_json' submission.id %}" data-endpoint-key="grader_errors">
    {% if not submission.complete and not submission.grader_errors %}
      <span class="italic">Error output is unavailable until the current run finishes</span>
      <span class="result-incomplete"></span>
    {% endif %}
    <code><pre>{{ submission.grader_errors }}</pre></code>
  </div>
{% endif %}

<h3 style="border-top:1px solid lightgray;padding-top:15px;">Submission</h3>
<code><pre>{{ submission_text }}</pre></code>

{% endblock %}
