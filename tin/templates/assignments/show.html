{% extends "base.html" %}
{% load staticfiles %}

{% block title %}Turn-In: {{ assignment.name }}{% endblock %}

{% if latest_submission %}
  {% block head %}
    <script>var latest_submission_json_url = "{{ latest_submission_url }}";</script>
    <script src="{% static 'js/assignments.show.js' %}"></script>
  {% endblock %}
{% endif %}

{% block main %}
<div class="header">
  <h2 class="left">{{ assignment.name }}</h2>
  {% if request.user.is_teacher or request.user.is_superuser %}
    <a class="right tin-btn" href="{% url 'assignments:edit' assignment.id %}">Edit</a>
  {% endif %}
  {% if request.user.is_student %}
    <a class="right tin-btn" href="{% url 'assignments:submit' assignment.id %}">Submit</a>
  {% endif %}
</div>
<p>{{ assignment.description }}</h1>

<table id="assignment-info">
  <tr>
    <th>Points possible:</th>
    <td>{{ assignment.points_possible }}</td>
  </tr>
  <tr>
    <th>Due:</th>
    <td>{{ assignment.due }}</td>
  </tr>
  {% if request.user.is_student %}
  <tr>
    <th>Grade:</th>
    <td id="grade">
      {% if not latest_submission %}
      <span class="italic">Not yet submitted</span>
      {% elif not latest_submission.has_been_graded %}
      Not graded yet
      {% else %}
      {{ latest_submission.points_received }}/{{ latest_submission.points_possible }} ({{ latest_submission.grade_percent }})
      {% endif %}
    </td>
  </tr>
  {% endif %}
</table>

{% if request.user.is_student %}
  {% if submissions %}
    <h3 style="border-top:1px solid lightgray;padding-top:15px;">Grader output</h3>
    <div id="grader-output"{% if not latest_submission.grader_output %} class="not-graded"{% endif %}>
      {% if latest_submission.grader_output %}
        <code><pre>{{ latest_submission.grader_output }}</pre></code>
      {% else %}
        Your code hasn't been graded yet.
      {% endif %}
    </div>
    <div id="grader-status" class="italic"></div>
  {% endif %}
{% endif %}

<h3 style="border-top:1px solid lightgray;padding-top:15px;">Submissions</h3>
<table id="submission-list" class="has-border">
{% if request.user.is_student %}
  <tr>
    <th style="min-width:125px;">Date submitted</th>
    <th style="min-width:65px;">On time?</th>
    <th style="min-width:90px;">Grade</th>
  </tr>
  {% for submission in submissions %}
  <tr>
    <td><a href="{% url 'submissions:show' submission.id %}">{{ submission.date_submitted }}</a></td>
    <td>{% if submission.is_on_time %}Yes{% else %}No{% endif %}</td>
    <td{% if submission.id == latest_submission.id %} id="submission-list-grade"{% endif %}>
      {% if submission.has_been_graded %}
      {{ submission.points_received }}/{{ submission.points_possible }} ({{ submission.grade_percent }})
      {% else %}
      <span class="italic">Not graded yet</span>
      {% endif %}
    </td>
  </tr>
  {% endfor %}

  {% if not submissions %}
  <tr>
    <td colspan="3" class="italic center">No submissions</td>
  </tr>
  {% endif %}
{% else %}
  <tr>
    <th style="min-width:125px">Student</th>
    <th style="min-width:125px;">Last submission date</th>
    <th style="min-width:125px;">On time?</th>
    <th style="min-width:75px;">Grade</th>
  </tr>
  {% for student, submission in students_and_submissions %}
  <tr>
    <td><a href="{% url 'assignments:student_submission' assignment.id student.id %}">{{ student.full_name }} ({{ student.username }})</a></td>
    {% if submission %}
    <td>{{ submission.date_submitted }}</td>
    <td>{% if submission.is_on_time %}Yes{% else %}No{% endif %}</td>
    <td>
      {% if submission.has_been_graded %}
      {{ submission.points_received }}/{{ submission.points_possible }} ({{ submission.grade_percent }})
      {% else %}
      <span class="italic">Not graded yet</span>
      {% endif %}
    </td>
    {% else %}
    <td colspan="3" class="italic center">No submissions</td>
    {% endif %}
  </tr>
  {% endfor %}

  {% if not students_and_submissions %}
  <tr>
    <td colspan="4" class="italic center">No students in class</td>
  </tr>
  {% endif %}
{% endif %}
</table>

{% endblock %}
